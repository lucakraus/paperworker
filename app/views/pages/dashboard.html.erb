<div class="container">
  <div class="dashboard">
    <%= render "shared/profile" %>

    <div class="appointments-and-reviews">
    <% if @user.paperworker? %>
      <div class="appointments">
        <h4>My Requests</h4>
        <% if @appointments.pending %>
        <% @appointments.pending.each do |appointment| %>
        <div class="request-section">
        <div class="request-info">
        <p>You have a request from <strong><%=appointment.immigrant.name%></strong> on <%=appointment.date.strftime("%Y-%m-%d")%>
        </div>
        <div class="request-buttons">
          <%= simple_form_for(appointment, method: :patch, class: "request-form") do |f| %>
              <%= f.input :status, as: :hidden, input_html: { value: "accepted" } %>
              <%= f.submit "Accept", class: "accept-button" %>
            <% end %>
            <%= simple_form_for(appointment, method: :patch) do |f| %>
              <%= f.input :status, as: :hidden, input_html: { value: "declined" } %>
              <%= f.submit "Decline", class: "decline-button" %>
            <% end %>
          </div>
          </div>
          <% end %>
          <% else %>

            <p> No requests yet! </p>
          <% end %>

      </div>
      <div class="appointments">
        <h4>My Appointments</h4>
          <% @appointments.accepted.each do |appointment| %>
            <% if @user.immigrant? %>
              <p>You have an upcoming appointment with <%= appointment.paperworker.name %></p>
              <%= link_to "Chat", appointment_chat_path(appointment), class: "accept-button" %>
            <% else %>
              <p>You have an upcoming appointment with <%= appointment.immigrant.name %></p>
              <%= link_to "Chat", appointment_chat_path(appointment), class: "accept-button" %>
            <% end %>
          <% end %>
      </div>
      <div class="appointments">
        <h4>My Reviews </h4>
      </div>
  <% else %>
      <div class="appointments">
        <h4>My Requests</h4>
      <% @appointments.pending.each do |appointment| %>
        <p> Request for <%=appointment.paperworker.name %> still pending <p>
      <% end %>
      </div>
      <div class="appointments">
        <h4>My Appointments</h4>
          <% @appointments.accepted.each do |appointment| %>
          <p>You have an upcoming appointment with <%= appointment.paperworker.name %></p>
          <%= link_to "Chat", appointment_chat_path(appointment), class: "accept-button" %>
          <% end %>
      </div>
      <div class="appointments">
        <h4>My Reviews </h4>
      </div>
  <% end %>
    </div>
  </div>
</div>
